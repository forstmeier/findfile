#!/bin/bash

# updates the AWS Lambdas with the pre-uploaded code files in S3

AWS_OUTPUT=$( cat etc/config/config.json | jq '.aws' )

ARTIFACT_BUCKET=$( jq -r  '.s3.artifact_bucket' <<< "${AWS_OUTPUT}" ) 
DATABASE_FUNCTION=databaseFunction
QUERY_FUNCTION=queryFunction
SETUP_FUNCTION=setupFunction

aws lambda update-function-code --function-name $DATABASE_FUNCTION --s3-bucket $ARTIFACT_BUCKET --s3-key db.zip --region us-east-1
aws lambda update-function-code --function-name $QUERY_FUNCTION --s3-bucket $ARTIFACT_BUCKET --s3-key query.zip --region us-east-1
aws lambda update-function-code --function-name $SETUP_FUNCTION --s3-bucket $ARTIFACT_BUCKET --s3-key setup.zip --region us-east-1
